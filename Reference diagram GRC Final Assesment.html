<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fleet Management Security Architecture</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4efe9 100%);
            color: #333;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(90deg, #2c7744 0%, #5aaf6f 100%);
            color: white;
            padding: 25px 30px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.4rem;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.5;
        }
        
        .content {
            padding: 25px;
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        .visualization-container {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
        }
        
        .diagram-container {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            background: white;
            overflow: auto;
            min-height: 700px;
            position: relative;
        }
        
        #security-canvas {
            width: 1000px;
            height: 1800px;
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .controls-panel {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 20px;
            height: fit-content;
        }
        
        .controls-panel h3 {
            margin-bottom: 15px;
            color: #2c7744;
            border-bottom: 2px solid #5aaf6f;
            padding-bottom: 8px;
        }
        
        .filter-group {
            margin-bottom: 20px;
        }
        
        .filter-group h4 {
            margin-bottom: 10px;
            color: #555;
        }
        
        .filter-options {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .filter-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .filter-option input {
            margin: 0;
        }
        
        .filter-option label {
            font-size: 0.9rem;
        }
        
        .zone-info {
            background: white;
            border-radius: 6px;
            padding: 15px;
            margin-top: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .zone-info h4 {
            color: #2c7744;
            margin-bottom: 10px;
        }
        
        .zone-info p {
            font-size: 0.85rem;
            line-height: 1.4;
            color: #666;
        }
        
        button {
            padding: 8px 16px;
            background: #5aaf6f;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s;
            width: 100%;
            margin-top: 10px;
        }
        
        button:hover {
            background: #2c7744;
        }
        
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }
        
        .canvas-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
        }
        
        .canvas-controls button {
            width: auto;
            padding: 6px 12px;
            font-size: 0.9rem;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
            border-top: 1px solid #eaeaea;
        }
        
        @media (max-width: 1024px) {
            .visualization-container {
                grid-template-columns: 1fr;
            }
            
            .controls-panel {
                order: -1;
            }
            
            #security-canvas {
                width: 100%;
                height: 600px;
            }
        }
        
        @media (max-width: 768px) {
            header {
                padding: 20px 15px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .content {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Fleet Management Security Architecture</h1>
            <p class="subtitle">Comprehensive visualization of security zones, components, and data flows</p>
        </header>
        
        <div class="content">
            <div class="visualization-container">
                <div class="diagram-container">
                    <canvas id="security-canvas"></canvas>
                    <div class="canvas-controls">
                        <button id="zoom-in">Zoom In</button>
                        <button id="zoom-out">Zoom Out</button>
                        <button id="reset-view">Reset View</button>
                        <button id="animate-flows">Animate Data Flows</button>
                    </div>
                </div>
                
                <div class="controls-panel">
                    <h3>Security Zones</h3>
                    
                    <div class="filter-group">
                        <h4>Highlight Zones</h4>
                        <div class="filter-options">
                            <div class="filter-option">
                                <input type="checkbox" id="ext-zone" checked>
                                <label for="ext-zone">External Zone</label>
                            </div>
                            <div class="filter-option">
                                <input type="checkbox" id="dmz-zone" checked>
                                <label for="dmz-zone">DMZ Layer</label>
                            </div>
                            <div class="filter-option">
                                <input type="checkbox" id="app-zone" checked>
                                <label for="app-zone">Application Zone</label>
                            </div>
                            <div class="filter-option">
                                <input type="checkbox" id="data-zone" checked>
                                <label for="data-zone">Data Zone</label>
                            </div>
                            <div class="filter-option">
                                <input type="checkbox" id="iot-zone" checked>
                                <label for="iot-zone">IoT Zone</label>
                            </div>
                            <div class="filter-option">
                                <input type="checkbox" id="user-zone" checked>
                                <label for="user-zone">User Zone</label>
                            </div>
                            <div class="filter-option">
                                <input type="checkbox" id="sec-zone" checked>
                                <label for="sec-zone">Security Zone</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="filter-group">
                        <h4>Data Flow Types</h4>
                        <div class="filter-options">
                            <div class="filter-option">
                                <input type="checkbox" id="user-flow" checked>
                                <label for="user-flow">User Traffic</label>
                            </div>
                            <div class="filter-option">
                                <input type="checkbox" id="iot-flow" checked>
                                <label for="iot-flow">IoT Data</label>
                            </div>
                            <div class="filter-option">
                                <input type="checkbox" id="api-flow" checked>
                                <label for="api-flow">API Communications</label>
                            </div>
                            <div class="filter-option">
                                <input type="checkbox" id="security-flow" checked>
                                <label for="security-flow">Security Monitoring</label>
                            </div>
                        </div>
                    </div>
                    
                    <button id="highlight-pci">Highlight PCI Scope</button>
                    
                    <div class="zone-info">
                        <h4>Zone Information</h4>
                        <p id="zone-details">Hover over any component to see details about its security controls and purpose.</p>
                    </div>
                </div>
            </div>
            
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #ffebee; border-color: #f44336;"></div>
                    <span>External Zone</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #e3f2fd; border-color: #2196f3;"></div>
                    <span>DMZ Layer</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #e8f5e9; border-color: #4caf50;"></div>
                    <span>Application Zone</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #f3e5f5; border-color: #9c27b0;"></div>
                    <span>Data Zone</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #fff3e0; border-color: #ff9800;"></div>
                    <span>IoT Zone</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #e0f2f1; border-color: #009688;"></div>
                    <span>User Zone</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #fff8e1; border-color: #ffc107;"></div>
                    <span>Security Zone</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #ffcdd2; border-color: #d32f2f;"></div>
                    <span>PCI Scope</span>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Fleet Management Security Architecture | © 2023</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const canvas = document.getElementById('security-canvas');
            const ctx = canvas.getContext('2d');
            let scale = 1;
            let offsetX = 0;
            let offsetY = 0;
            let isDragging = false;
            let lastX, lastY;
            let animationId = null;
            let animationFrame = 0;
            
            // Set canvas size
            canvas.width = 1000;
            canvas.height = 1800;
            
            // Define security zones and components
            const zones = [
                {
                    id: 'ext',
                    name: 'External Zone',
                    x: 50, y: 50, width: 900, height: 100,
                    color: '#ffebee',
                    borderColor: '#f44336',
                    components: [
                        { id: 'internet', name: 'Internet / Third Parties', x: 100, y: 75, width: 200, height: 50 }
                    ]
                },
                {
                    id: 'dmz',
                    name: 'DMZ Layer',
                    x: 150, y: 200, width: 700, height: 120,
                    color: '#e3f2fd',
                    borderColor: '#2196f3',
                    components: [
                        { id: 'waf', name: 'WAF / Reverse Proxy', x: 200, y: 230, width: 180, height: 60 },
                        { id: 'api', name: 'API Gateway', x: 450, y: 230, width: 150, height: 60 }
                    ]
                },
                {
                    id: 'app',
                    name: 'Application Zone',
                    x: 100, y: 400, width: 800, height: 150,
                    color: '#e8f5e9',
                    borderColor: '#4caf50',
                    components: [
                        { id: 'fms', name: 'Fleet Mgmt System', x: 150, y: 430, width: 180, height: 60 },
                        { id: 'pay', name: 'Fuel Card Payment\n(PCI Scope)', x: 400, y: 430, width: 180, height: 60, pci: true },
                        { id: 'dash', name: 'Web Dashboard', x: 650, y: 430, width: 150, height: 60 }
                    ]
                },
                {
                    id: 'data',
                    name: 'Data Zone',
                    x: 200, y: 650, width: 600, height: 120,
                    color: '#f3e5f5',
                    borderColor: '#9c27b0',
                    components: [
                        { id: 'db', name: 'PostgreSQL (HQ)', x: 250, y: 680, width: 180, height: 60 },
                        { id: 'ddb', name: 'DynamoDB (Cloud)', x: 550, y: 680, width: 150, height: 60 }
                    ]
                },
                {
                    id: 'iot',
                    name: 'IoT Zone',
                    x: 50, y: 850, width: 400, height: 200,
                    color: '#fff3e0',
                    borderColor: '#ff9800',
                    components: [
                        { id: 'gw1', name: 'Truck IoT Gateway', x: 100, y: 900, width: 120, height: 40 },
                        { id: 'gw2', name: 'Truck IoT Gateway', x: 100, y: 960, width: 120, height: 40 },
                        { id: 'gw3', name: 'Truck IoT Gateway', x: 100, y: 1020, width: 120, height: 40 }
                    ]
                },
                {
                    id: 'user',
                    name: 'User Zone',
                    x: 550, y: 850, width: 400, height: 200,
                    color: '#e0f2f1',
                    borderColor: '#009688',
                    components: [
                        { id: 'tab', name: 'Driver Tablets\n(MDM/EDR)', x: 600, y: 900, width: 150, height: 60 },
                        { id: 'pc', name: 'Office Desktops\n(MDM/EDR)', x: 600, y: 1000, width: 150, height: 60 }
                    ]
                },
                {
                    id: 'sec',
                    name: 'Security Zone',
                    x: 50, y: 1150, width: 900, height: 120,
                    color: '#fff8e1',
                    borderColor: '#ffc107',
                    components: [
                        { id: 'soc', name: 'SOC / SIEM', x: 100, y: 1180, width: 150, height: 60 },
                        { id: 'ids', name: 'IDS/IPS', x: 400, y: 1180, width: 120, height: 60 },
                        { id: 'mdm', name: 'MDM & EDR Controller', x: 700, y: 1180, width: 180, height: 60 }
                    ]
                }
            ];
            
            // Define data flows
            const flows = [
                { from: 'internet', to: 'waf', type: 'user', color: '#2196f3' },
                { from: 'waf', to: 'api', type: 'api', color: '#2196f3' },
                { from: 'api', to: 'fms', type: 'api', color: '#4caf50' },
                { from: 'api', to: 'pay', type: 'api', color: '#4caf50' },
                { from: 'fms', to: 'db', type: 'api', color: '#9c27b0' },
                { from: 'pay', to: 'db', type: 'api', color: '#9c27b0' },
                { from: 'fms', to: 'ddb', type: 'api', color: '#9c27b0' },
                { from: 'gw1', to: 'api', type: 'iot', color: '#ff9800' },
                { from: 'gw2', to: 'api', type: 'iot', color: '#ff9800' },
                { from: 'gw3', to: 'api', type: 'iot', color: '#ff9800' },
                { from: 'tab', to: 'waf', type: 'user', color: '#009688' },
                { from: 'pc', to: 'dash', type: 'user', color: '#009688' },
                { from: 'db', to: 'soc', type: 'security', color: '#ffc107' },
                { from: 'ddb', to: 'soc', type: 'security', color: '#ffc107' },
                { from: 'ids', to: 'waf', type: 'security', color: '#ffc107' },
                { from: 'ids', to: 'api', type: 'security', color: '#ffc107' },
                { from: 'ids', to: 'fms', type: 'security', color: '#ffc107' },
                { from: 'ids', to: 'pay', type: 'security', color: '#ffc107' },
                { from: 'mdm', to: 'tab', type: 'security', color: '#ffc107' },
                { from: 'mdm', to: 'pc', type: 'security', color: '#ffc107' }
            ];
            
            // Zone information data
            const zoneInfo = {
                'ext': {
                    title: 'External Zone',
                    description: 'Contains internet-facing components and third-party services. This zone is exposed to the highest risk and requires strong perimeter security controls.',
                    controls: ['Firewall rules', 'DDoS protection', 'Traffic filtering']
                },
                'dmz': {
                    title: 'DMZ Layer',
                    description: 'Demilitarized Zone acts as a buffer between external and internal networks. Contains reverse proxy and API gateway for controlled access.',
                    controls: ['WAF (Web Application Firewall)', 'API Gateway', 'Reverse Proxy', 'TLS termination']
                },
                'app': {
                    title: 'Application Zone',
                    description: 'Hosts business applications including Fleet Management System, Payment Processing, and Web Dashboard. Enforces application-level security.',
                    controls: ['Authentication & Authorization', 'Input validation', 'Session management', 'PCI-DSS compliance for payment system']
                },
                'data': {
                    title: 'Data Zone',
                    description: 'Contains databases and data storage systems. This zone has the highest protection requirements for sensitive data.',
                    controls: ['Encryption at rest', 'Database firewall', 'Access controls', 'Backup & recovery']
                },
                'iot': {
                    title: 'IoT Zone',
                    description: 'Manages IoT gateways in trucks that collect telemetry data. Requires secure communication channels.',
                    controls: ['mTLS authentication', 'Firmware integrity checks', 'Secure VPN tunnels', 'Device management']
                },
                'user': {
                    title: 'User Zone',
                    description: 'End-user devices including driver tablets and office desktops. Protected by endpoint security solutions.',
                    controls: ['MDM (Mobile Device Management)', 'EDR (Endpoint Detection & Response)', 'Device encryption', 'Remote wipe capability']
                },
                'sec': {
                    title: 'Security Zone',
                    description: 'Centralized security monitoring and management. Collects logs and alerts from all other zones.',
                    controls: ['SIEM (Security Information & Event Management)', 'IDS/IPS (Intrusion Detection/Prevention)', 'Security analytics', 'Incident response']
                }
            };
            
            // Initialize the visualization
            function init() {
                drawDiagram();
                setupEventListeners();
            }
            
            // Draw the entire diagram
            function drawDiagram() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Apply transformations for zoom and pan
                ctx.save();
                ctx.translate(offsetX, offsetY);
                ctx.scale(scale, scale);
                
                // Draw flows first (so they appear behind components)
                drawFlows();
                
                // Draw zones and components
                drawZones();
                
                ctx.restore();
            }
            
            // Draw all security zones and their components
            function drawZones() {
                zones.forEach(zone => {
                    // Check if zone should be visible
                    const zoneCheckbox = document.getElementById(`${zone.id}-zone`);
                    if (!zoneCheckbox.checked) return;
                    
                    // Draw zone background
                    ctx.fillStyle = zone.color;
                    ctx.strokeStyle = zone.borderColor;
                    ctx.lineWidth = 2;
                    ctx.fillRect(zone.x, zone.y, zone.width, zone.height);
                    ctx.strokeRect(zone.x, zone.y, zone.width, zone.height);
                    
                    // Draw zone label
                    ctx.fillStyle = '#333';
                    ctx.font = 'bold 14px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(zone.name, zone.x + zone.width/2, zone.y + 20);
                    
                    // Draw components in this zone
                    zone.components.forEach(component => {
                        // Draw component background
                        ctx.fillStyle = component.pci ? '#ffcdd2' : '#fff';
                        ctx.strokeStyle = component.pci ? '#d32f2f' : '#666';
                        ctx.lineWidth = component.pci ? 3 : 1;
                        ctx.fillRect(component.x, component.y, component.width, component.height);
                        ctx.strokeRect(component.x, component.y, component.width, component.height);
                        
                        // Draw component text
                        ctx.fillStyle = '#333';
                        ctx.font = '10px Arial';
                        ctx.textAlign = 'center';
                        
                        const lines = component.name.split('\n');
                        for (let i = 0; i < lines.length; i++) {
                            ctx.fillText(lines[i], component.x + component.width/2, component.y + 20 + (i * 12));
                        }
                    });
                });
            }
            
            // Draw all data flows between components
            function drawFlows() {
                flows.forEach(flow => {
                    // Check if flow type should be visible
                    const flowCheckbox = document.getElementById(`${flow.type}-flow`);
                    if (!flowCheckbox.checked) return;
                    
                    const fromComponent = findComponent(flow.from);
                    const toComponent = findComponent(flow.to);
                    
                    if (fromComponent && toComponent) {
                        // Calculate start and end points
                        const fromX = fromComponent.x + fromComponent.width/2;
                        const fromY = fromComponent.y + fromComponent.height/2;
                        const toX = toComponent.x + toComponent.width/2;
                        const toY = toComponent.y + toComponent.height/2;
                        
                        // Set line style
                        ctx.strokeStyle = flow.color;
                        ctx.lineWidth = 2;
                        ctx.setLineDash([]);
                        
                        // Draw the line with arrow
                        drawArrow(fromX, fromY, toX, toY);
                        
                        // Animate flow if enabled
                        if (document.getElementById('animate-flows').classList.contains('active')) {
                            animateFlow(fromX, fromY, toX, toY, flow.color);
                        }
                    }
                });
            }
            
            // Draw an arrow between two points
            function drawArrow(fromX, fromY, toX, toY) {
                ctx.beginPath();
                ctx.moveTo(fromX, fromY);
                
                // Add a curve for better visualization
                const cpX1 = fromX + (toX - fromX) * 0.5;
                const cpY1 = fromY;
                const cpX2 = toX - (toX - fromX) * 0.5;
                const cpY2 = toY;
                
                ctx.bezierCurveTo(cpX1, cpY1, cpX2, cpY2, toX, toY);
                ctx.stroke();
                
                // Draw arrowhead
                const angle = Math.atan2(toY - fromY, toX - fromX);
                const headLength = 10;
                
                ctx.beginPath();
                ctx.moveTo(toX, toY);
                ctx.lineTo(
                    toX - headLength * Math.cos(angle - Math.PI/6),
                    toY - headLength * Math.sin(angle - Math.PI/6)
                );
                ctx.moveTo(toX, toY);
                ctx.lineTo(
                    toX - headLength * Math.cos(angle + Math.PI/6),
                    toY - headLength * Math.sin(angle + Math.PI/6)
                );
                ctx.stroke();
            }
            
            // Animate a flow with a moving dot
            function animateFlow(fromX, fromY, toX, toY, color) {
                const progress = (animationFrame % 100) / 100;
                
                // Calculate position along the curve
                const cpX1 = fromX + (toX - fromX) * 0.5;
                const cpY1 = fromY;
                const cpX2 = toX - (toX - fromX) * 0.5;
                const cpY2 = toY;
                
                const t = progress;
                const x = Math.pow(1-t, 3) * fromX + 
                          3 * Math.pow(1-t, 2) * t * cpX1 + 
                          3 * (1-t) * Math.pow(t, 2) * cpX2 + 
                          Math.pow(t, 3) * toX;
                
                const y = Math.pow(1-t, 3) * fromY + 
                          3 * Math.pow(1-t, 2) * t * cpY1 + 
                          3 * (1-t) * Math.pow(t, 2) * cpY2 + 
                          Math.pow(t, 3) * toY;
                
                // Draw moving dot
                ctx.fillStyle = color;
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // Find a component by ID
            function findComponent(id) {
                for (const zone of zones) {
                    for (const component of zone.components) {
                        if (component.id === id) {
                            return component;
                        }
                    }
                }
                return null;
            }
            
            // Set up event listeners
            function setupEventListeners() {
                // Canvas interaction
                canvas.addEventListener('mousedown', startDrag);
                canvas.addEventListener('mousemove', drag);
                canvas.addEventListener('mouseup', endDrag);
                canvas.addEventListener('wheel', handleZoom);
                
                // Control buttons
                document.getElementById('zoom-in').addEventListener('click', () => {
                    scale *= 1.2;
                    drawDiagram();
                });
                
                document.getElementById('zoom-out').addEventListener('click', () => {
                    scale /= 1.2;
                    drawDiagram();
                });
                
                document.getElementById('reset-view').addEventListener('click', () => {
                    scale = 1;
                    offsetX = 0;
                    offsetY = 0;
                    drawDiagram();
                });
                
                document.getElementById('animate-flows').addEventListener('click', function() {
                    this.classList.toggle('active');
                    if (this.classList.contains('active')) {
                        this.style.background = '#2c7744';
                        startAnimation();
                    } else {
                        this.style.background = '#5aaf6f';
                        stopAnimation();
                    }
                });
                
                document.getElementById('highlight-pci').addEventListener('click', function() {
                    // Highlight PCI components
                    zones.forEach(zone => {
                        zone.components.forEach(component => {
                            if (component.pci) {
                                component.originalColor = component.pci ? '#ffcdd2' : '#fff';
                                component.color = '#ff0000';
                            }
                        });
                    });
                    drawDiagram();
                    
                    // Reset after 3 seconds
                    setTimeout(() => {
                        zones.forEach(zone => {
                            zone.components.forEach(component => {
                                if (component.pci) {
                                    component.color = component.originalColor;
                                }
                            });
                        });
                        drawDiagram();
                    }, 3000);
                });
                
                // Filter controls
                document.querySelectorAll('.filter-option input').forEach(checkbox => {
                    checkbox.addEventListener('change', drawDiagram);
                });
                
                // Component hover info
                canvas.addEventListener('mousemove', function(e) {
                    const rect = canvas.getBoundingClientRect();
                    const x = (e.clientX - rect.left - offsetX) / scale;
                    const y = (e.clientY - rect.top - offsetY) / scale;
                    
                    let hoveredComponent = null;
                    
                    // Check if hovering over a component
                    zones.forEach(zone => {
                        zone.components.forEach(component => {
                            if (x >= component.x && x <= component.x + component.width &&
                                y >= component.y && y <= component.y + component.height) {
                                hoveredComponent = component;
                            }
                        });
                    });
                    
                    if (hoveredComponent) {
                        canvas.style.cursor = 'pointer';
                        // Find which zone this component belongs to
                        const zone = zones.find(z => z.components.includes(hoveredComponent));
                        if (zone && zoneInfo[zone.id]) {
                            const info = zoneInfo[zone.id];
                            document.getElementById('zone-details').innerHTML = `
                                <strong>${info.title} - ${hoveredComponent.name.split('\n')[0]}</strong><br>
                                ${info.description}<br><br>
                                <strong>Key Controls:</strong><br>
                                ${info.controls.map(control => `• ${control}`).join('<br>')}
                            `;
                        }
                    } else {
                        canvas.style.cursor = 'default';
                        document.getElementById('zone-details').innerHTML = 
                            'Hover over any component to see details about its security controls and purpose.';
                    }
                });
            }
            
            // Animation functions
            function startAnimation() {
                if (animationId) return;
                
                function animate() {
                    animationFrame++;
                    drawDiagram();
                    animationId = requestAnimationFrame(animate);
                }
                
                animate();
            }
            
            function stopAnimation() {
                if (animationId) {
                    cancelAnimationFrame(animationId);
                    animationId = null;
                }
                animationFrame = 0;
                drawDiagram();
            }
            
            // Zoom and pan functions
            function handleZoom(e) {
                e.preventDefault();
                const zoomIntensity = 0.1;
                const wheel = e.deltaY < 0 ? 1 : -1;
                const zoom = Math.exp(wheel * zoomIntensity);
                
                scale *= zoom;
                drawDiagram();
            }
            
            function startDrag(e) {
                isDragging = true;
                lastX = e.clientX;
                lastY = e.clientY;
                canvas.style.cursor = 'grabbing';
            }
            
            function drag(e) {
                if (!isDragging) return;
                
                const deltaX = e.clientX - lastX;
                const deltaY = e.clientY - lastY;
                
                offsetX += deltaX;
                offsetY += deltaY;
                
                lastX = e.clientX;
                lastY = e.clientY;
                
                drawDiagram();
            }
            
            function endDrag() {
                isDragging = false;
                canvas.style.cursor = 'default';
            }
            
            // Initialize the visualization
            init();
        });
    </script>
</body>
</html>