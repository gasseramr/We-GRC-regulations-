<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GreenFuel Logistics System Scope</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4efe9 100%);
            color: #333;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(90deg, #2c7744 0%, #5aaf6f 100%);
            color: white;
            padding: 25px 30px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.4rem;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.5;
        }
        
        .content {
            padding: 25px;
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        .diagram-container {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            background: white;
            overflow: auto;
            min-height: 700px;
            position: relative;
        }
        
        .canvas-container {
            width: 100%;
            height: 700px;
            position: relative;
            overflow: auto;
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        #system-canvas {
            width: 1200px;
            height: 1800px;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }
        
        button {
            padding: 8px 16px;
            background: #5aaf6f;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #2c7744;
        }
        
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 8px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        
        .notes {
            background: #f0f7ff;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #5aaf6f;
        }
        
        .notes h3 {
            margin-bottom: 12px;
            color: #2c7744;
        }
        
        .notes ul {
            padding-left: 20px;
        }
        
        .notes li {
            margin-bottom: 8px;
            line-height: 1.5;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
            border-top: 1px solid #eaeaea;
        }
        
        .node {
            position: absolute;
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            min-width: 180px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .node:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
        }
        
        .connection {
            position: absolute;
            background: #999;
            transform-origin: 0 0;
        }
        
        .connection-dashed {
            border-top: 2px dashed #999;
        }
        
        .connection-solid {
            border-top: 2px solid #999;
        }
        
        .connection-pci {
            border-top: 2px solid #b23b3b;
        }
        
        .endpoint {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #999;
            position: absolute;
        }
        
        @media (max-width: 768px) {
            header {
                padding: 20px 15px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .content {
                padding: 15px;
            }
            
            .legend {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .canvas-container {
                height: 500px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>GreenFuel Logistics System Scope</h1>
            <p class="subtitle">Comprehensive overview of the system architecture, components, and data flows</p>
        </header>
        
        <div class="content">
            <div class="diagram-container">
                <div class="canvas-container">
                    <canvas id="system-canvas"></canvas>
                </div>
                <div class="controls">
                    <button id="zoom-in">Zoom In</button>
                    <button id="zoom-out">Zoom Out</button>
                    <button id="reset-view">Reset View</button>
                </div>
            </div>
            
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #e6f2ff; border: 1px solid #99ccff;"></div>
                    <span>Environment Components</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #ffe6e6; border: 2px solid #b23b3b;"></div>
                    <span>PCI Scope Components</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="border: 1px dashed #666;"></div>
                    <span>Human Interaction</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="border: 1px solid #666;"></div>
                    <span>System Interaction</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="border: 2px solid #b23b3b;"></div>
                    <span>PCI Data Flow</span>
                </div>
            </div>
            
            <div class="notes">
                <h3>System Notes & Highlights</h3>
                <ul>
                    <li><strong>AWS IoT Core</strong> handles cloud telemetry ingestion, device registry, and device defender</li>
                    <li><strong>On-prem PostgreSQL database</strong> holds PII, driver records, and transaction metadata (non-PAN)</li>
                    <li><strong>Fuel Card Payment System</strong> is in PCI scope and uses tokenization for secure payments</li>
                    <li><strong>Security components</strong> include SOC/SIEM, VPN with mTLS, IDS, and MDM/EDR for endpoints</li>
                    <li><strong>200 tablets</strong> used by drivers are managed via MDM and have endpoint detection response</li>
                </ul>
            </div>
        </div>
        
        <footer>
            <p>GreenFuel Logistics System Architecture | Â© 2023</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const canvas = document.getElementById('system-canvas');
            const ctx = canvas.getContext('2d');
            let scale = 1;
            let panning = false;
            let startX, startY;
            let offsetX = 0;
            let offsetY = 0;
            
            // Initialize the canvas
            function init() {
                canvas.width = 1200;
                canvas.height = 1800;
                drawDiagram();
                setupEventListeners();
            }
            
            // Draw the entire system diagram
            function drawDiagram() {
                // Clear canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Draw connections first (so they appear behind nodes)
                drawConnections();
                
                // Draw all nodes
                drawNodes();
            }
            
            // Define node positions and properties
            const nodes = [
                // On-Premises nodes
                { id: 'A_WS', x: 100, y: 100, width: 200, height: 80, color: '#e6f2ff', border: '#99ccff', text: 'Windows Server 2016\n(Identity, AD, Management)' },
                { id: 'A_DB', x: 100, y: 200, width: 200, height: 80, color: '#e6f2ff', border: '#99ccff', text: 'PostgreSQL 12\n(Core DB: vehicle, routes, fuel)' },
                { id: 'A_IOTGW_OnPrem', x: 100, y: 300, width: 200, height: 80, color: '#e6f2ff', border: '#99ccff', text: 'IoT Gateway (Local Edge)\n(Debian 11)' },
                
                // Cloud nodes
                { id: 'C_IOT', x: 400, y: 100, width: 200, height: 80, color: '#e6f2ff', border: '#99ccff', text: 'AWS IoT Core\n(Device registry, telemetry)' },
                { id: 'C_DDB', x: 400, y: 200, width: 200, height: 80, color: '#e6f2ff', border: '#99ccff', text: 'DynamoDB\n(Telemetry store & caching)' },
                { id: 'C_Analytics', x: 400, y: 300, width: 200, height: 80, color: '#e6f2ff', border: '#99ccff', text: 'Analytics / Stream Processing' },
                { id: 'C_IAM', x: 400, y: 400, width: 200, height: 80, color: '#e6f2ff', border: '#99ccff', text: 'AWS IAM & KMS' },
                
                // Non-Prod nodes
                { id: 'N_Staging', x: 700, y: 100, width: 200, height: 80, color: '#e6f2ff', border: '#99ccff', text: 'Staging / UAT\nTest DB / Test IoT' },
                
                // Application nodes
                { id: 'App_FMS', x: 250, y: 500, width: 200, height: 80, color: '#fff', border: '#666', text: 'Fleet Management System\n(Web Dashboard)' },
                { id: 'App_Mobile', x: 250, y: 600, width: 200, height: 80, color: '#fff', border: '#666', text: 'Driver Mobile App\n(200 Tablets)' },
                { id: 'App_Pay', x: 250, y: 700, width: 200, height: 80, color: '#ffe6e6', border: '#b23b3b', text: 'Fuel Card Payment System\n(PCI scope)' },
                { id: 'App_GPS', x: 250, y: 800, width: 200, height: 80, color: '#fff', border: '#666', text: 'GPS & Telemetry Aggregator' },
                
                // Endpoint nodes
                { id: 'E_Tablets', x: 550, y: 600, width: 200, height: 80, color: '#fff', border: '#666', text: '200 Tablets (Drivers)\nMDM, EDR' },
                { id: 'E_Desktops', x: 550, y: 700, width: 200, height: 80, color: '#fff', border: '#666', text: '50 Desktops (Offices)' },
                
                // Security nodes
                { id: 'S_SOC', x: 100, y: 900, width: 200, height: 80, color: '#fff', border: '#666', text: 'SOC / SIEM / Log Mgmt' },
                { id: 'S_VPN', x: 100, y: 1000, width: 200, height: 80, color: '#fff', border: '#666', text: 'VPN & mTLS between IoT Gateways and HQ' },
                { id: 'S_IDS', x: 100, y: 1100, width: 200, height: 80, color: '#fff', border: '#666', text: 'Network IDS / IoT IDS' },
                { id: 'S_MDM', x: 100, y: 1200, width: 200, height: 80, color: '#fff', border: '#666', text: 'MDM & EDR' },
                
                // Third-party nodes
                { id: 'T_PaymentGateway', x: 400, y: 900, width: 200, height: 80, color: '#fff', border: '#666', text: 'Payment Gateway\n(Tokenization, PCI Provider)' },
                { id: 'T_MapAPI', x: 400, y: 1000, width: 200, height: 80, color: '#fff', border: '#666', text: 'Mapping / GPS Provider' },
                { id: 'T_VendorSaaS', x: 400, y: 1100, width: 200, height: 80, color: '#fff', border: '#666', text: 'SaaS: Notifications, Billing' },
                
                // Stakeholder nodes
                { id: 'ST_Exec', x: 700, y: 500, width: 200, height: 60, color: '#f9f9f9', border: '#999', text: 'Business Owners / Execs' },
                { id: 'ST_Fleet', x: 700, y: 580, width: 200, height: 60, color: '#f9f9f9', border: '#999', text: 'Fleet Managers' },
                { id: 'ST_IT', x: 700, y: 660, width: 200, height: 60, color: '#f9f9f9', border: '#999', text: 'IT Operations' },
                { id: 'ST_Sec', x: 700, y: 740, width: 200, height: 60, color: '#f9f9f9', border: '#999', text: 'CISO / Security / SOC' },
                { id: 'ST_Compliance', x: 700, y: 820, width: 200, height: 60, color: '#f9f9f9', border: '#999', text: 'Compliance / Legal' },
                { id: 'ST_Drivers', x: 700, y: 900, width: 200, height: 60, color: '#f9f9f9', border: '#999', text: 'Drivers / On-road Users' }
            ];
            
            // Define connections between nodes
            const connections = [
                // Applications to On-Prem and Cloud
                { from: 'App_FMS', to: 'A_DB', type: 'solid' },
                { from: 'App_FMS', to: 'C_DDB', type: 'solid' },
                { from: 'App_Mobile', to: 'App_FMS', type: 'solid' },
                { from: 'App_Mobile', to: 'C_IOT', type: 'solid' },
                { from: 'App_GPS', to: 'C_IOT', type: 'solid' },
                { from: 'App_Pay', to: 'T_PaymentGateway', type: 'pci' },
                { from: 'App_Pay', to: 'A_DB', type: 'pci' },
                
                // IoT gateways flow
                { from: 'A_IOTGW_OnPrem', to: 'S_VPN', type: 'solid' },
                { from: 'S_VPN', to: 'C_IOT', type: 'solid' },
                { from: 'A_IOTGW_OnPrem', to: 'App_GPS', type: 'solid' },
                { from: 'A_IOTGW_OnPrem', to: 'C_DDB', type: 'solid' },
                
                // Endpoints access apps
                { from: 'E_Tablets', to: 'App_Mobile', type: 'solid' },
                { from: 'E_Desktops', to: 'App_FMS', type: 'solid' },
                
                // Security connections
                { from: 'C_IOT', to: 'S_SOC', type: 'solid' },
                { from: 'A_DB', to: 'S_SOC', type: 'solid' },
                { from: 'App_Pay', to: 'S_SOC', type: 'pci' },
                { from: 'S_IDS', to: 'A_IOTGW_OnPrem', type: 'solid' },
                { from: 'S_IDS', to: 'C_IOT', type: 'solid' },
                { from: 'S_MDM', to: 'E_Tablets', type: 'solid' },
                { from: 'S_MDM', to: 'E_Desktops', type: 'solid' },
                
                // Third-party integrations
                { from: 'T_MapAPI', to: 'App_GPS', type: 'solid' },
                { from: 'T_PaymentGateway', to: 'App_Pay', type: 'pci' },
                { from: 'T_VendorSaaS', to: 'App_FMS', type: 'solid' },
                
                // Stakeholder interactions (dashed lines for human interaction)
                { from: 'ST_Fleet', to: 'App_FMS', type: 'dashed' },
                { from: 'ST_Drivers', to: 'E_Tablets', type: 'dashed' },
                { from: 'ST_IT', to: 'A_WS', type: 'dashed' },
                { from: 'ST_Sec', to: 'S_SOC', type: 'dashed' },
                { from: 'ST_Compliance', to: 'App_Pay', type: 'dashed' },
                { from: 'ST_Exec', to: 'App_FMS', type: 'dashed' }
            ];
            
            // Draw all nodes
            function drawNodes() {
                nodes.forEach(node => {
                    // Draw node background
                    ctx.fillStyle = node.color;
                    ctx.strokeStyle = node.border;
                    ctx.lineWidth = 2;
                    ctx.fillRect(node.x, node.y, node.width, node.height);
                    ctx.strokeRect(node.x, node.y, node.width, node.height);
                    
                    // Draw node text
                    ctx.fillStyle = '#333';
                    ctx.font = '12px Arial';
                    ctx.textAlign = 'center';
                    
                    const lines = node.text.split('\n');
                    for (let i = 0; i < lines.length; i++) {
                        ctx.fillText(lines[i], node.x + node.width/2, node.y + 25 + (i * 18));
                    }
                });
            }
            
            // Draw all connections between nodes
            function drawConnections() {
                connections.forEach(conn => {
                    const fromNode = nodes.find(n => n.id === conn.from);
                    const toNode = nodes.find(n => n.id === conn.to);
                    
                    if (fromNode && toNode) {
                        // Calculate start and end points
                        const fromX = fromNode.x + fromNode.width/2;
                        const fromY = fromNode.y + fromNode.height/2;
                        const toX = toNode.x + toNode.width/2;
                        const toY = toNode.y + toNode.height/2;
                        
                        // Set line style based on connection type
                        if (conn.type === 'dashed') {
                            ctx.setLineDash([5, 5]);
                            ctx.strokeStyle = '#666';
                        } else if (conn.type === 'pci') {
                            ctx.setLineDash([]);
                            ctx.strokeStyle = '#b23b3b';
                            ctx.lineWidth = 2;
                        } else {
                            ctx.setLineDash([]);
                            ctx.strokeStyle = '#666';
                            ctx.lineWidth = 1;
                        }
                        
                        // Draw the line
                        ctx.beginPath();
                        ctx.moveTo(fromX, fromY);
                        
                        // Add a curve for better visualization
                        const cpX1 = fromX + (toX - fromX) * 0.5;
                        const cpY1 = fromY;
                        const cpX2 = toX - (toX - fromX) * 0.5;
                        const cpY2 = toY;
                        
                        ctx.bezierCurveTo(cpX1, cpY1, cpX2, cpY2, toX, toY);
                        ctx.stroke();
                        
                        // Reset line dash
                        ctx.setLineDash([]);
                    }
                });
            }
            
            // Set up event listeners for zooming and panning
            function setupEventListeners() {
                // Zoom in button
                document.getElementById('zoom-in').addEventListener('click', () => {
                    scale *= 1.2;
                    applyTransform();
                });
                
                // Zoom out button
                document.getElementById('zoom-out').addEventListener('click', () => {
                    scale /= 1.2;
                    applyTransform();
                });
                
                // Reset view button
                document.getElementById('reset-view').addEventListener('click', () => {
                    scale = 1;
                    offsetX = 0;
                    offsetY = 0;
                    applyTransform();
                });
                
                // Panning functionality
                canvas.addEventListener('mousedown', (e) => {
                    panning = true;
                    startX = e.clientX - offsetX;
                    startY = e.clientY - offsetY;
                    canvas.style.cursor = 'grabbing';
                });
                
                canvas.addEventListener('mouseup', () => {
                    panning = false;
                    canvas.style.cursor = 'default';
                });
                
                canvas.addEventListener('mousemove', (e) => {
                    if (panning) {
                        offsetX = e.clientX - startX;
                        offsetY = e.clientY - startY;
                        applyTransform();
                    }
                });
                
                // Touch events for mobile devices
                canvas.addEventListener('touchstart', (e) => {
                    if (e.touches.length === 1) {
                        panning = true;
                        startX = e.touches[0].clientX - offsetX;
                        startY = e.touches[0].clientY - offsetY;
                    }
                });
                
                canvas.addEventListener('touchend', () => {
                    panning = false;
                });
                
                canvas.addEventListener('touchmove', (e) => {
                    if (panning && e.touches.length === 1) {
                        offsetX = e.touches[0].clientX - startX;
                        offsetY = e.touches[0].clientY - startY;
                        applyTransform();
                    }
                });
            }
            
            // Apply the current transform to the canvas
            function applyTransform() {
                const container = document.querySelector('.canvas-container');
                container.scrollLeft = -offsetX;
                container.scrollTop = -offsetY;
            }
            
            // Initialize the diagram
            init();
        });
    </script>
</body>
</html>